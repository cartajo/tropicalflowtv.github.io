<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tropical Flow ‚Äî Audio & Video</title>
<style>
  :root { --accent:#1db954; }

  /* Base */
  *{box-sizing:border-box}
  body{margin:0;background:#000;color:#fff;font-family:system-ui,Segoe UI,Arial,sans-serif}
  .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
  h1{font-size:22px;margin:0 0 12px}
  h2{font-size:18px;margin:24px 0 10px}

  /* Tarjetas/secciones */
  .card{background:#0e0e0e;border-radius:16px;padding:16px;box-shadow:0 0 0 1px #1a1a1a;margin-bottom:18px}
  .controls{display:flex;gap:8px;margin:8px 0 14px;flex-wrap:wrap}
  button{border:0;border-radius:10px;padding:10px 14px;background:#1f1f1f;color:#fff;cursor:pointer}
  button:hover{background:#2a2a2a}
  button.primary{background:var(--accent);color:#000}
  audio, video{width:100%;max-height:62vh;background:#000}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width: 820px){ .grid{grid-template-columns:1fr} }

  /* Listas */
  ul{list-style:none;padding:0;margin:0;max-height:58vh;overflow:auto;border-radius:12px;background:#0b0b0b}
  li{padding:10px 12px;border-bottom:1px solid #141414;cursor:pointer;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  li:hover{background:#141414}
  li.active{background:var(--accent);color:#000;font-weight:600}
  .status{opacity:.85;font-size:13px;margin-top:8px}
  .hint{opacity:.7;font-size:12px;margin-top:6px}

  /* === Carrusel === */
  .carousel-wrap{position:relative;margin-top:12px}
  .carousel{display:flex;gap:10px;overflow-x:auto;scroll-snap-type:x mandatory;padding:8px;background:#0b0b0b;border-radius:12px}
  .carousel::-webkit-scrollbar{height:8px}
  .carousel::-webkit-scrollbar-thumb{background:#222;border-radius:8px}
  .ccard{flex:0 0 220px;scroll-snap-align:start;background:#111;border:1px solid #1a1a1a;border-radius:12px;padding:8px}
  .ccard h4{margin:6px 0 0;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .thumb{width:100%;aspect-ratio:16/9;background:#000;border-radius:8px;display:grid;place-items:center}
  .thumb span{font-size:32px;opacity:.8}
  .cbtn{position:absolute;top:45%;transform:translateY(-50%);border:0;border-radius:50%;width:36px;height:36px;background:#1f1f1f;color:#fff;cursor:pointer}
  .cbtn:hover{background:#2a2a2a}
  .cprev{left:-6px}
  .cnext{right:-6px}
</style>
</head>
<body>
  <div class="wrap">
    <h1>‚ñ∂ Tropical Flow ‚Äî Audio & Video</h1>

    <!-- AUDIO -->
    <section class="card" aria-label="Reproductor de audio">
      <h2>Playlist VIP 2 (Audio)</h2>
      <div class="controls">
        <button id="aprev" aria-label="Anterior">‚èÆ Anterior</button>
        <button id="aplay" class="primary" aria-label="Play o Pausa">‚èØ Play/Pausa</button>
        <button id="anext" aria-label="Siguiente">‚è≠ Siguiente</button>
      </div>
      <audio id="aplayer" controls></audio>
      <div id="anow" class="status">Cargando playlist‚Ä¶</div>
      <div class="grid">
        <ul id="aplaylist" aria-label="Lista de canciones"></ul>
        <div class="hint">
          Sube tus MP3 a <b>/musica2/</b>. Si alguno queda en 0:00, abre su URL directa para confirmar que existe.
          Recomendado ‚â§ 25&nbsp;MB por archivo.
        </div>
      </div>
    </section>

    <!-- VIDEO -->
    <section class="card" aria-label="Reproductor de video">
      <h2>Canal de Videos (MP4)</h2>
      <div class="controls">
        <button id="vprev" aria-label="Anterior">‚èÆ Anterior</button>
        <button id="vplay" class="primary" aria-label="Play o Pausa">‚èØ Play/Pausa</button>
        <button id="vnext" aria-label="Siguiente">‚è≠ Siguiente</button>
      </div>
      <video id="vplayer" controls playsinline></video>
      <div id="vnow" class="status">Buscando videos‚Ä¶</div>
      <div class="grid">
        <ul id="vlist" aria-label="Lista de videos"></ul>
        <div class="hint">
          Sube tus MP4 a <b>/Privado/videos/</b>. Si no existe esa carpeta, el sistema intentar√° leer los MP4 que
          est√©n directamente en <b>/Privado/</b>. Recomendado ‚â§ 50‚Äì100&nbsp;MB por archivo.
        </div>
      </div>
    </section>

    <!-- CARRUSEL DE VIDEOS -->
    <section class="card" aria-label="Carrusel de videos">
      <h2>üéû Carrusel de Videos</h2>
      <div class="carousel-wrap">
        <button class="cbtn cprev" id="cPrev" aria-label="Desplazar carrusel a la izquierda">‚Äπ</button>
        <div class="carousel" id="vCarousel">
          <!-- Se llena por JS con las tarjetas de cada MP4 -->
        </div>
        <button class="cbtn cnext" id="cNext" aria-label="Desplazar carrusel a la derecha">‚Ä∫</button>
      </div>
      <div class="hint">Tip: desliza con el dedo o usa ‚Äπ / ‚Ä∫ para navegar. Toca cualquier tarjeta para reproducir ese video arriba.</div>
    </section>
  </div>

<script>
/* ===========================
   CONFIG GENERAL (ajusta si cambias el repo)
   =========================== */
const GH_OWNER = "cartajo";
const GH_REPO  = "tropicalflowtv.github.io";

/* ===========================
   AUDIO (lee /musica2 desde /Privado/)
   =========================== */
const MUSIC_DIR = "musica2";
const A_REL_FROM_PRIVADO = "../"; // desde /Privado/ al root
const A_API = https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${MUSIC_DIR};

const aPlayer = document.getElementById("aplayer");
const aListEl = document.getElementById("aplaylist");
const aNow = document.getElementById("anow");
let aTracks = [], aIndex = 0;

function niceTitle(name){
  return decodeURIComponent(name.replace(/\.[^/.]+$/, "").replace(/_/g," "));
}
function audioPath(name){
  // encodeURIComponent maneja espacios y caracteres especiales
  return A_REL_FROM_PRIVADO + MUSIC_DIR + "/" + encodeURIComponent(name);
}

async function loadAudio(){
  aNow.textContent = "Cargando playlist‚Ä¶";
  try{
    const r = await fetch(A_API,{headers:{"Accept":"application/vnd.github+json"}});
    if(!r.ok) throw new Error("No se pudo leer /musica2/");
    const items = (await r.json()).filter(x => x.type==="file" && /\.mp3$/i.test(x.name))
                                  .sort((a,b)=>a.name.localeCompare(b.name,'es',{numeric:true,sensitivity:'base'}));
    if(!items.length){ aNow.textContent="No hay MP3 en /musica2/."; return; }
    aTracks = items.map(f=>({ title:niceTitle(f.name), src:audioPath(f.name) }));
    renderList(aListEl, aTracks, i=>selectAudio(i,true));
    selectAudio(0,false);
    aNow.textContent = Lista cargada: ${aTracks.length} canciones;
  }catch(e){
    aNow.textContent = "Error cargando audio. (¬øRepo p√∫blico? ¬øL√≠mite de API?)";
    console.error(e);
  }
}
function renderList(ul, arr, onClick){
  ul.innerHTML="";
  arr.forEach((t,i)=>{
    const li=document.createElement("li");
    li.textContent=t.title; li.dataset.i=i;
    li.addEventListener("click",()=>onClick(i));
    ul.appendChild(li);
  });
}
function highlight(ul, idx){
  [...ul.children].forEach((li,i)=>li.classList.toggle("active", i===idx));
}
function selectAudio(i, autoplay=false){
  aIndex=i; aPlayer.src=aTracks[i].src; highlight(aListEl,i);
  document.title = "‚ñ∂ " + aTracks[i].title + " ‚Äî Tropical Flow";
  aNow.textContent = "Reproduciendo: " + aTracks[i].title;
  if(autoplay) aPlayer.play().catch(()=>{});
}
document.getElementById("anext").onclick = ()=>selectAudio((aIndex+1)%aTracks.length,true);
document.getElementById("aprev").onclick = ()=>selectAudio((aIndex-1+aTracks.length)%aTracks.length,true);
document.getElementById("aplay").onclick = ()=>{ aPlayer.paused ? aPlayer.play() : aPlayer.pause(); };
aPlayer.addEventListener("ended", ()=>document.getElementById("anext").click());

/* ===========================
   VIDEO (lee /Privado/videos o /Privado)
   =========================== */
const V_PRIMARY = https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/Privado/videos;
const V_FALLBACK = https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/Privado;
const vPlayer = document.getElementById("vplayer");
const vListEl = document.getElementById("vlist");
const vNow = document.getElementById("vnow");
let vTracks=[], vIndex=0;

function videoPathFromPrivado(name, inSubfolder){
  // Si est√°n en /Privado/videos: "videos/archivo.mp4"; si no, solo "archivo.mp4"
  return (inSubfolder ? "videos/" : "") + encodeURIComponent(name);
}
async function loadVideos(){
  vNow.textContent="Buscando videos en /Privado/videos/‚Ä¶";
  try{
    let inSub = true;
    let r = await fetch(V_PRIMARY,{headers:{"Accept":"application/vnd.github+json"}});
    if(!r.ok){ inSub=false; r = await fetch(V_FALLBACK,{headers:{"Accept":"application/vnd.github+json"}}); }
    if(!r.ok) throw new Error("No se pudo leer /Privado/");
    const items = (await r.json()).filter(x => x.type==="file" && /\.mp4$/i.test(x.name))
                                  .sort((a,b)=>a.name.localeCompare(b.name,'es',{numeric:true,sensitivity:'base'}));
    if(!items.length){ vNow.textContent="No hay MP4 a√∫n en /Privado/videos ni en /Privado."; return; }
    vTracks = items.map(f=>({ title:niceTitle(f.name), src:videoPathFromPrivado(f.name, inSub) }));
    renderList(vListEl, vTracks, i=>selectVideo(i,true));
    selectVideo(0,false);
    vNow.textContent = Videos cargados: ${vTracks.length};
    renderCarousel(); // llena carrusel
  }catch(e){
    vNow.textContent="Error cargando videos. (¬øRepo p√∫blico? ¬øL√≠mite de API?)";
    console.error(e);
  }
}
function selectVideo(i, autoplay=false){
  vIndex=i; vPlayer.src=vTracks[i].src; highlight(vListEl,i);
  vNow.textContent = "Video: " + vTracks[i].title;
  if(autoplay) vPlayer.play().catch(()=>{});
}
document.getElementById("vnext").onclick = ()=>selectVideo((vIndex+1)%vTracks.length,true);
document.getElementById("vprev").onclick = ()=>selectVideo((vIndex-1+vTracks.length)%vTracks.length,true);
document.getElementById("vplay").onclick = ()=>{ vPlayer.paused ? vPlayer.play() : vPlayer.pause(); };

/* ===========================
   CARRUSEL DE VIDEOS
   =========================== */
const vCarousel = document.getElementById("vCarousel");
const cPrev = document.getElementById("cPrev");
const cNext = document.getElementById("cNext");

function renderCarousel(){
  if(!vCarousel) return;
  vCarousel.innerHTML = "";
  vTracks.forEach((t, i)=>{
    const card = document.createElement("div");
    card.className = "ccard";
    card.title = t.title;

    const thumb = document.createElement("div");
    thumb.className = "thumb";
    // No tenemos miniaturas de video, dejamos un √≠cono play
    thumb.innerHTML = "<span>‚ñ∂</span>";

    const h4 = document.createElement("h4");
    h4.textContent = t.title;

    card.appendChild(thumb);
    card.appendChild(h4);
    card.addEventListener("click", ()=>selectVideo(i, true));

    vCarousel.appendChild(card);
  });
}
function scrollCarousel(dir){
  const step = 240; // px por tarjeta
  vCarousel.scrollBy({left: dir*step, behavior:"smooth"});
}
if(cPrev && cNext){
  cPrev.addEventListener("click", ()=>scrollCarousel(-1));
  cNext.addEventListener("click", ()=>scrollCarousel(1));
}

/* ===========================
   INICIO
   =========================== */
loadAudio();
loadVideos();
</script>
</body>
</html>
